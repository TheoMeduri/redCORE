<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../style.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <title>Red Core - Admin</title>
    <style>
        /* Estilos para a área de conteúdo */
        .content {
            padding: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: auto;
        }

        body.dark-mode .content {
            background-color: #242424;
            box-shadow: 0 0 5px #161616;
        }

        /* Estilos para o formulário */
        form {
            background: #ffffff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            max-width: 100%;
        }

        body.dark-mode form {
            background-color: #272727;
            box-shadow: 0 0 8px #161616;
        }

        /* Estilos para os rótulos */
        label {
            display: block;
            margin: 12px 0 6px;
            font-weight: 500;
            font-size: 18px;
            color: #333;
        }

        body.dark-mode label{
            color: #e3e3e3;
        }

        /* Estilos para os campos de entrada */
        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 16px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box; /* Inclui padding e border na largura total */
        }

        body.dark-mode input[type="text"], input[type="password"] {
            background-color: #272727;
            box-shadow: 0 0 8px #161616;
            border: 1px solid #303030;
        }

        /* Estilos para o botão de envio */
        button {
            padding: 12px 24px;
            background-color: #395168;
            border: none;
            color: white;
            font-size: 18px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }

        /* Estilos para o botão ao passar o mouse */
        button:hover {
            background-color: #2c3e50;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <nav class="sidebar">
            <div class="logo">
                <img src="../../Logo-RedCORE-Branco-Horizontal.png" alt="Red Core">
            </div>
            <div class="search-bar">
                <i class='bx bx-search'></i>
                <input type="search" placeholder="Pesquise aqui..." id="searchInput">
                <span class="pi-icon" id="piIcon">PI</span>
            </div>
            <ul class="menu">
                <li class="menu-item">
                    <a href="../index">
                        <span class="icon"><i class='bx bxs-dashboard'></i></span>
                        <span class="title">Dashboard</span>
                    </a>
                </li>
                <li class="menu-item has-submenu">
                    <a href="#">
                        <span class="icon"><i class='bx bx-user'></i></span>
                        <span class="title">Users</span>
                    </a>
                    <ul class="submenu">
                        <li><a href="./allUsers"><span class="submenu-icon"><i class='bx bx-list-ul'></i></span>All Users</a></li>
                        <li><a href="./newUser" class="active"><span class="submenu-icon"><i class='bx bx-user-plus'></i></span>Add New</a></li>
                    </ul>
                </li>
                <li class="menu-item has-submenu">
                    <a href="#">
                        <span class="icon"><i class='bx bx-receipt'></i></span>
                        <span class="title">Relatórios</span>
                    </a>
                    <ul class="submenu">
                        <li><a href="../relatorios/alarmes"><span class="submenu-icon"><i class='bx bx-alarm'></i></span>Relatórios de Alarmes</a></li>
                        <li><a href="../relatorios/service"><span class="submenu-icon"><i class='bx bx-user-voice'></i></span>Relatório de Atendimento</a></li>
                        <li><a href="../relatorios/chamado"><span class="submenu-icon"><i class='bx bxs-key'></i></span>Abertura de Chamado</a></li>
                    </ul>
                </li>
                <li class="menu-item">
                    <a href="../reports">
                        <span class="icon"><i class='bx bx-chart'></i></span>
                        <span class="title">Reports</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="../configs">
                        <span class="icon"><i class='bx bx-cog'></i></span>
                        <span class="title">Settings</span>
                    </a>
                </li>
            </ul>
            <div class="profile">
                <a href="#">
                    <div class="profile-info">
                        <img src="profile-pic.jpg" alt="Profile Picture">
                        <span class="name" id="profileName" onclick="Profile()"></span>
                    </div>
                    <span class="icon" id="logoutButton"><i class='bx bx-log-out'></i></span>
                </a>
            </div>
        </nav>
        <div class="main-content">
            <header>
                <h1>Adicionar Usuário</h1>
            </header>
            <div class="content">
                <!-- Formulário de Cadastro -->
                <form id="registrationForm">
                    <h2>Cadastro de Usuário</h2>
                    <label for="name">Nome:</label>
                    <input type="text" id="name" name="name" required>
                    
                    <label for="contact">Telefone ou Email:</label>
                    <input type="text" id="contact" name="contact" required>
                    
                    <label for="cnpj">CNPJ:</label>
                    <input type="text" id="cnpj" name="cnpj" required>
                    
                    <label for="password">Senha:</label>
                    <input type="password" id="password" name="password" required>
                    
                    <button type="submit">Cadastrar</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
    const registrationForm = document.getElementById('registrationForm');

    // Submissão do formulário de cadastro
    registrationForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const name = document.getElementById('name').value;
        const contact = document.getElementById('contact').value; // Este será o ID
        const cnpj = document.getElementById('cnpj').value;
        const password = document.getElementById('password').value;

        // Recupera usuários existentes do localStorage ou cria uma lista vazia
        const users = JSON.parse(localStorage.getItem('users')) || [];

        // Verifica se o contato já existe
        const existingUser = users.find(user => user.contact === contact);
        if (existingUser) {
            alert('Usuário já cadastrado com este contato.');
            return;
        }

        // Adiciona novo usuário à lista
        const newUser = {
            id: contact, // Usando o contato como ID
            name,
            contact,
            cnpj,
            password
        };
        users.push(newUser);

        // Salva a lista de usuários no localStorage
        localStorage.setItem('users', JSON.stringify(users));

        alert('Cadastro realizado com sucesso!');
        registrationForm.reset();
    });
});

// Dados de login com nomes
const validUsers = [
    { username: 'Gabriel Meduri', password: 'Roots123', name: 'Gabriel Meduri' },
    { username: 'Theo Meduri', password: 'Roots123', name: 'Theo Meduri' },
    { username: 'admin3', password: 'pass789', name: 'Admin 3' },
    { username: 'admin4', password: 'pass000', name: 'Admin 4' },
    { username: 'admin5', password: 'pass111', name: 'Admin 5' }
];

// Mostrar o modal ao carregar a página se não estiver logado
window.addEventListener('load', () => {
    const loginModal = document.getElementById('loginModal');
    const closeButton = document.querySelector('.close-button');
    const loginForm = document.getElementById('loginForm');
    const profileName = document.getElementById('profileName');
    const profileInfo = document.querySelector('.profile-info');

    // Verifica se o usuário está logado
    const loggedInUser = localStorage.getItem('loggedInUser');
    if (loggedInUser) {
        // Usuário está logado, exibe o nome do perfil
        const user = JSON.parse(loggedInUser);
        profileName.textContent = user.name;
        const initial = user.name.charAt(0).toUpperCase(); // Pega a inicial do nome
        const profileImg = document.querySelector('.profile-info img');
        profileImg.style.display = 'none'; // Oculta a imagem de perfil existente
        const avatar = document.createElement('div');
        avatar.classList.add('avatar');
        avatar.textContent = initial;
        profileInfo.insertBefore(avatar, profileName);
        loginModal.style.display = 'none';
    } else {
        // Usuário não está logado, exibe o modal de login
        loginModal.style.display = 'block';
    }

    // Fechar o modal
    closeButton.addEventListener('click', () => {
        if (!localStorage.getItem('loggedInUser')) {
            // Se não estiver logado, não fecha o modal
            alert('Você precisa fazer login para fechar este modal.');
        } else {
            loginModal.style.display = 'none';
        }
    });

    // Submissão do formulário de login
    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        const user = validUsers.find(user => user.username === username && user.password === password);

        if (user) {
            // Usuário validado
            localStorage.setItem('loggedInUser', JSON.stringify(user));
            loginModal.style.display = 'none';
            const initial = user.name.charAt(0).toUpperCase(); // Pega a inicial do nome
            profileName.textContent = user.name; // Atualiza o nome do perfil

            // Atualiza a imagem do perfil com a inicial
            const profileImg = document.querySelector('.profile-info img');
            profileImg.style.display = 'none'; // Oculta a imagem de perfil existente
            const avatar = document.createElement('div');
            avatar.classList.add('avatar');
            avatar.textContent = initial;
            profileInfo.insertBefore(avatar, profileName);
        } else {
            alert('Usuário ou senha incorretos.');
        }
    });
});

function Profile() {
    window.location.href = 'profile.html';
}


    </script>

<script src="../js/dark-mode.js"></script>
</body>
</html>
